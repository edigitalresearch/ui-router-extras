/*! ui-router-extras - v0.0.10 - 2014-10-24 */!function(a,b,c){function d(a,b){var c=[];for(var d in a.path){if(a.path[d]!==b.path[d])break;c.push(a.path[d])}return c}function e(a){if(Object.keys)return Object.keys(a);var c=[];return b.forEach(a,function(a,b){c.push(b)}),c}function f(a,b){if(Array.prototype.indexOf)return a.indexOf(b,Number(arguments[2])||0);var c=a.length>>>0,d=Number(arguments[2])||0;for(d=0>d?Math.ceil(d):Math.floor(d),0>d&&(d+=c);c>d;d++)if(d in a&&a[d]===b)return d;return-1}function g(a,b,c,g){var h,i=d(c,g),j={},k=[];for(var l in i)if(i[l].params&&(h=r(i[l].params)?i[l].params:e(i[l].params),h.length))for(var m in h)f(k,h[m])>=0||(k.push(h[m]),j[h[m]]=a[h[m]]);return q({},j,b)}function h(a,b){return q(new(q(function(){},{prototype:a})),b)}function i(){n=c}function j(){var a={},c={};this.registerStickyState=function(a){c[a.name]=a},this.enableDebug=function(a){o=a},this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(c,d,e,f,h){function i(){var c={};return b.forEach(a,function(a){for(var b=j(a),d=0;d<b.length;d++){var e=b[d].parent;c[e.name]=c[e.name]||[],c[e.name].push(a)}c[""]&&(c.__inactives=c[""])}),c}function j(a){var b=[];if(!a)return b;do a.sticky&&b.push(a),a=a.parent;while(a);return b.reverse(),b}function k(a,b,c){if(a[c]===b[c])return{from:!1,to:!1};var d=c<a.length&&a[c].self.sticky,e=c<b.length&&b[c].self.sticky;return{from:d,to:e}}function l(b,c,d){if(d)return"updateStateParams";var e=a[b.self.name];if(!e)return"enter";var f=n(c,e.locals.globals.$stateParams,b.ownParams);return f?"reactivate":"updateStateParams"}function m(b,c){var d=a[b.name];if(!d)return null;if(!c)return d;var e=n(c,d.locals.globals.$stateParams,b.ownParams);return e?d:null}function n(a,b,c){if(!c){c=[];for(var d in a)c.push(d)}for(var e=0;e<c.length;e++){var f=c[e];if(a[f]!=b[f])return!1}return!0}var p={getInactiveStates:function(){var c=[];return b.forEach(a,function(a){c.push(a)}),c},getInactiveStatesByParent:function(){return i()},processTransition:function(a){var c={inactives:[],enter:[],exit:[],keep:0},f=a.fromState.path,h=a.fromParams,j=a.toState.path,m=a.toParams,o=a.options,p=0,q=j[p];for(o.inherit&&(m=g(e,m||{},d.$current,a.toState));q&&q===f[p]&&n(m,h,q.ownParams);)q=j[++p];c.keep=p;var r,t,u,v={},w=k(f,j,p),x=!1;for(r=p;r<j.length;r++){var y=w.to?l(j[r],a.toParams,x):"enter";x=x||"updateStateParams"==y,c.enter[r]=y,"reactivate"==y&&(u=v[j[r].name]=j[r]),"updateStateParams"==y&&(t=j[r])}u=u?u.self.name+".":"",t=t?t.self.name+".":"";var z=i(),A=[""].concat(s(f.slice(0,p),function(a){return a.self.name}));for(b.forEach(A,function(a){for(var b=z[a],d=0;b&&d<b.length;d++){var e=b[d];v[e.name]||u&&0===e.self.name.indexOf(u)||t&&0===e.self.name.indexOf(t)||c.inactives.push(e)}}),r=p;r<f.length;r++){var B="exit";w.from&&(c.inactives.push(f[r]),B="inactivate"),c.exit[r]=B}return c},stateInactivated:function(b){a[b.self.name]=b,b.self.status="inactive",b.self.onInactivate&&f.invoke(b.self.onInactivate,b.self,b.locals.globals)},stateReactivated:function(b){a[b.self.name]&&delete a[b.self.name],b.self.status="entered",b.self.onReactivate&&f.invoke(b.self.onReactivate,b.self,b.locals.globals)},stateExiting:function(c,d,e){var g={};b.forEach(d,function(a){g[a.self.name]=!0}),b.forEach(a,function(b,d){!g[d]&&b.includes[c.name]&&(o&&h.debug("Exiting "+d+" because it's a substate of "+c.name+" and wasn't found in ",g),b.self.onExit&&f.invoke(b.self.onExit,b.self,b.locals.globals),b.locals=null,b.self.status="exited",delete a[d])}),e&&f.invoke(e,c.self,c.locals.globals),c.locals=null,c.self.status="exited",delete a[c.self.name]},stateEntering:function(a,b,c){var d=m(a);if(d&&!m(a,b)){var e=a.locals;this.stateExiting(d),a.locals=e}a.self.status="entered",c&&f.invoke(c,a.self,a.locals.globals)}};return p}]}function k(a){return{resolve:{},locals:{globals:v&&v.locals&&v.locals.globals},views:{},self:{},params:{},ownParams:[],surrogateType:a}}function l(a,c,d){function e(a,b,c){return a[b]?a[b].toUpperCase()+": "+c.self.name:"("+c.self.name+")"}var f=s(d.inactives,function(a){return a.self.name}),g=s(c.toState.path,function(a,b){return e(d.enter,b,a)}),h=s(c.fromState.path,function(a,b){return e(d.exit,b,a)}),i=c.fromState.self.name+": "+b.toJson(c.fromParams)+":  -> "+c.toState.self.name+": "+b.toJson(c.toParams);a.debug("   Current transition: ",i),a.debug("Before transition, inactives are:   : ",s(u.getInactiveStates(),function(a){return a.self.name})),a.debug("After transition,  inactives will be: ",f),a.debug("Transition will exit:  ",h),a.debug("Transition will enter: ",g)}function m(a,b,c){a.debug("Current state: "+b.self.name+", inactive states: ",s(u.getInactiveStates(),function(a){return a.self.name}));for(var d=function(a,b){return"'"+b+"' ("+a.$$state.name+")"},e=function(a,b){return"globals"!=b&&"resolve"!=b},f=function(a){var b=s(t(a.locals,e),d).join(", ");return"("+(a.self.name?a.self.name:"root")+".locals"+(b.length?": "+b:"")+")"},g=f(b),h=b.parent;h&&h!==b;)""===h.self.name&&(g=f(c.$current.path[0])+" / "+g),g=f(h)+" / "+g,b=h,h=b.parent;a.debug("Views: "+g)}b.module("ct.ui.router.extras",["ui.router"]);var n,o=!1,p=b.forEach,q=b.extend,r=b.isArray,s=function(a,b){"use strict";var c=[];return p(a,function(a,d){c.push(b(a,d))}),c},t=function(a,b){"use strict";var c={};return p(a,function(a,d){b(a,d)&&(c[d]=a)}),c};b.module("ct.ui.router.extras").config(["$provide",function(a){var b;a.decorator("$state",["$delegate","$q",function(a,c){return b=a.transitionTo,a.transitionTo=function(d,e,f){return f.ignoreDsr&&(n=f.ignoreDsr),b.apply(a,arguments).then(function(a){return i(),a},function(a){return i(),c.reject(a)})},a}])}]),b.module("ct.ui.router.extras").service("$deepStateRedirect",["$rootScope","$state","$injector",function(a,d,e){function f(a){var b=a.name;return j.hasOwnProperty(b)?j[b]:void g(b)}function g(a){var b=d.get(a);b&&b.deepStateRedirect&&(j[a]=k,h[a]===c&&(h[a]=a));var e=a.lastIndexOf(".");if(-1!=e){var f=g(a.substr(0,e));f&&j[a]===c&&(j[a]=l)}return j[a]||!1}var h={},i={},j={},k="Redirect",l="AncestorRedirect";return a.$on("$stateChangeStart",function(a,c){function g(){if(n)return!1;var a=f(c),d=h[c.name],g=a===k&&d&&d!=c.name?!0:!1;return g&&b.isFunction(c.deepStateRedirect)?e.invoke(c.deepStateRedirect,c):g}g()&&(a.preventDefault(),d.go(h[c.name],i[c.name]))}),a.$on("$stateChangeSuccess",function(a,c,d){var e=f(c);if(e){var g=c.name;b.forEach(h,function(a,c){(g==c||-1!=g.indexOf(c+"."))&&(h[c]=g,i[c]=b.copy(d))})}}),{}}]),b.module("ct.ui.router.extras").run(["$deepStateRedirect",function(){}]),j.$inject=["$stateProvider"],b.module("ct.ui.router.extras").provider("$stickyState",j);var u,v,w,x,y={},z=[];b.module("ct.ui.router.extras").run(["$stickyState",function(a){u=a}]),b.module("ct.ui.router.extras").config(["$provide","$stateProvider","$stickyStateProvider",function(a,d,e){x=b.extend(new k("__inactives"),{self:{name:"__inactives"}}),v=w=c,z=[],d.decorator("parent",function(a,b){return y[a.self.name]=a,a.self.$$state=function(){return y[a.self.name]},a.self.sticky===!0&&e.registerStickyState(a.self),b(a)});var f;a.decorator("$state",["$delegate","$log","$q",function(a,d,e){return v=a.$current,v.parent=x,x.parent=c,v.locals=h(x.locals,v.locals),delete x.locals.globals,f=a.transitionTo,a.transitionTo=function(c,g,h){function i(a){var c=b.extend(new k("reactivate_phase1"),{locals:a.locals});return c.self=b.extend({},a.self),c}function j(a){var c=b.extend(new k("reactivate_phase2"),a),d=c.self.onEnter;return c.resolve={},c.views={},c.self.onEnter=function(){c.locals=a.locals,u.stateReactivated(a)},K.addRestoreFunction(function(){a.self.onEnter=d}),c}function n(a){var b=new k("inactivate");b.self=a.self;var c=a.self.onExit;return b.self.onExit=function(){u.stateInactivated(a)},K.addRestoreFunction(function(){a.self.onExit=c}),b}function p(a,b){var c=a.self.onEnter;return a.self.onEnter=function(){u.stateEntering(a,b,c)},K.addRestoreFunction(function(){a.self.onEnter=c}),a}function q(a){var b=a.self.onExit;return a.self.onExit=function(){u.stateExiting(a,I,b)},K.addRestoreFunction(function(){a.self.onExit=b}),a}x.locals||(x.locals=v.locals);var r=z.length;w&&(w(),o&&d.debug("Restored paths from pending transition"));var t,A,B,C,D=a.$current,E=a.params,F=h&&h.relative||a.$current,G=a.get(c,F),H=[],I=[],J=function(){},K=function(){t&&(L.path=t,t=null),A&&(D.path=A,A=null),b.forEach(K.restoreFunctions,function(a){a()}),K=J,w=null,z.splice(r,1)};if(K.restoreFunctions=[],K.addRestoreFunction=function(a){this.restoreFunctions.push(a)},G){var L=y[G.name];if(L){t=L.path,A=D.path;var M={toState:L,toParams:g||{},fromState:D,fromParams:E||{},options:h};z.push(M),w=K,B=u.processTransition(M),o&&l(d,M,B);var N=L.path.slice(0,B.keep),O=D.path.slice(0,B.keep);b.forEach(x.locals,function(a,b){-1!=b.indexOf("@")&&delete x.locals[b]});for(var P=0;P<B.inactives.length;P++){var Q=B.inactives[P].locals;b.forEach(Q,function(a,b){Q.hasOwnProperty(b)&&-1!=b.indexOf("@")&&(x.locals[b]=a)})}if(b.forEach(B.enter,function(a,b){var c;"reactivate"===a?(c=i(L.path[b]),N.push(c),O.push(c),H.push(j(L.path[b])),C=c):"updateStateParams"===a?(c=p(L.path[b]),N.push(c),C=c):"enter"===a&&N.push(p(L.path[b]))}),b.forEach(B.exit,function(a,b){var c=D.path[b];"inactivate"===a?(O.push(n(c)),I.push(c)):"exit"===a&&(O.push(q(c)),I.push(c))}),H.length&&b.forEach(H,function(a){N.push(a)}),C){var R=C.self.name+".",S=u.getInactiveStates(),T=[];S.forEach(function(a){0===a.self.name.indexOf(R)&&T.push(a)}),T.sort(),T.reverse(),O=O.concat(s(T,function(a){return q(a)})),I=I.concat(T)}L.path=N,D.path=O;var U=function(a){return(a.surrogateType?a.surrogateType+":":"")+a.self.name};o&&d.debug("SurrogateFromPath: ",s(O,U)),o&&d.debug("SurrogateToPath:   ",s(N,U))}}var V=f.apply(a,arguments);return V.then(function(b){return K(),o&&m(d,y[b.name],a),b.status="active",b},function(a){return K(),o&&"transition prevented"!==a.message&&"transition aborted"!==a.message&&"transition superseded"!==a.message&&(d.debug("transition failed",a),console.log(a.stack)),e.reject(a)})},a}])}]),b.module("ct.ui.router.extras").provider("$futureState",["$stateProvider","$urlRouterProvider",function(a,c){function d(a,b){if(b.name)for(var c=b.name.split(/\./);c.length;){var d=c.join(".");if(a.get(d))return null;if(i[d])return i[d];c.pop()}if(b.url)for(var e=b.url.split(/\//);e.length;){var f=e.join("/");if(j[f])return j[f];e.pop()}}function e(a,b){if(!b){var c=$q.defer();return c.reject("No lazyState passed in "+b),c.promise}var d=b.type,e=h[d];if(!e)throw Error("No state factory for futureState.type: "+(b&&b.type));return a.invoke(e,e,{futureState:b})}function f(b,c){var f=!1,h=["$rootScope","$urlRouter","$state",function(h,i,j){if(!m)return g().then(function(){f=!0,i.sync(),f=!1}),void(m=!0);var l=d(j,{url:c.path()});return l?(k=!0,void e(b,l).then(function(b){b&&(!j.get(b)||b.name&&!j.get(b.name))&&a.state(b),f=!0,i.sync(),f=!1,k=!1},function(){k=!1,j.go("top")})):b.invoke(o)}];if(!k){var i=f?o:h;return b.invoke(i)}}var g,h={},i={},j={},k=!1,l=[],m=!1,n=this;this.addResolve=function(a){l.push(a)},this.stateFactory=function(a,b){h[a]=b},this.futureState=function(a){i[a.stateName]=a,j[a.urlPrefix]=a},this.get=function(){return b.extend({},i)};var o=["$log","$location",function(a,b){a.debug("Unable to map "+b.path())}];c.otherwise(f),c.otherwise=function(a){if(b.isString(a)){var d=a;a=function(){return d}}else if(!b.isFunction(a))throw new Error("'rule' must be a function");return o=a,c};var p={getResolvePromise:function(){return g()}};this.$get=["$injector","$state","$q","$rootScope","$urlRouter","$timeout","$log",function(c,f,h,i,j,m,o){function q(){if(i.$on("$stateNotFound",function(b,g,h,i){if(!k){o.debug("event, unfoundState, fromState, fromParams",b,g,h,i);var j=d(f,{name:g.to});if(j){b.preventDefault(),k=!0;var l=e(c,j);l.then(function(b){b&&a.state(b),f.go(g.to,g.toParams),k=!1},function(a){console.log("failed to lazy load state ",a),f.go(h,i),k=!1})}}}),!g){var n=[];b.forEach(l,function(a){n.push(c.invoke(a))}),g=function(){return h.all(n)}}g().then(function(){m(function(){f.transition?f.transition.then(j.sync,j.sync):j.sync()})})}return q(),p.state=a.state,p.futureState=n.futureState,p.get=n.get,p}]}]),b.module("ct.ui.router.extras").run(["$futureState",function(){}]),b.module("ct.ui.router.extras").service("$previousState",["$rootScope","$state",function(a,b){var c=null,d={},e=null;a.$on("$stateChangeStart",function(a,b,d,f,g){e=c,c={state:f,params:g}}),a.$on("$stateChangeError",function(){c=e,e=null}),a.$on("$stateChangeSuccess",function(){e=null});var f={get:function(a){return a?d[a]:c},go:function(a,c){var d=f.get(a);return b.go(d.state,d.params,c)},memo:function(a,e,f){d[a]=c||{state:b.get(e),params:f}},forget:function(a){delete d[a]}};return f}]),b.module("ct.ui.router.extras").run(["$previousState",function(){}]),b.module("ct.ui.router.extras").config(["$provide",function(a){a.decorator("$state",["$delegate","$rootScope","$q","$injector",function(a,c,d,e){function f(a){var c=e.invoke,d=e.instantiate;return e.invoke=function(d,e,f){return c(d,e,b.extend({$transition$:a},f))},e.instantiate=function(c,e){return d(c,b.extend({$transition$:a},e))},function(){e.invoke=c,e.instantiate=d}}function g(){m.pop()(),l.pop(),k--}function h(a,b){return function(d){return g(),c.$broadcast("$transitionSuccess",b),a.resolve(d)}}function i(a,b){return function(d){return g(),c.$broadcast("$transitionError",b,d),a.reject(d)}}var j=a.transitionTo,k=-1,l=[],m=[];return a.transitionTo=function(){var b=d.defer(),c=l[++k]={promise:b.promise};m[k]=function(){};var e=j.apply(a,arguments);return e.then(h(b,c),i(b,c))},c.$on("$stateChangeStart",function(a,d,e,g,h){var i=k,j=b.extend(l[i],{to:{state:d,params:e},from:{state:g,params:h}}),n=f(j);m[i]=n,c.$broadcast("$transitionStart",j)}),a}])}])}(window,window.angular);